# Ultralytics YOLO ğŸš€, AGPL-3.0 license
# YOLO11-jde joint detection and embedding model with P2 feature layer for small object detection
# For Usage examples see https://docs.ultralytics.com/tasks/jde

# Parameters
nc: 1 # number of classes
state_classes: 6  # çŠ¶æ€ç±»åˆ«æ•°
scales: # model compound scaling constants, i.e. 'model=yolo11n-jde.yaml' will call yolo11-jde.yaml with scale 'n'
  # [depth, width, max_channels]
  n: [0.50, 0.25, 1024] # summary: 355 layers, 2876848 parameters, 2876832 gradients, 10.5 GFLOPs
  s: [0.50, 0.50, 1024] # summary: 355 layers, 10113248 parameters, 10113232 gradients, 35.8 GFLOPs
  m: [0.50, 1.00, 512] # summary: 445 layers, 22420896 parameters, 22420880 gradients, 123.9 GFLOPs
  l: [1.00, 1.00, 512] # summary: 667 layers, 27678368 parameters, 27678352 gradients, 143.0 GFLOPs
  x: [1.00, 1.50, 512] # summary: 667 layers, 62142656 parameters, 62142640 gradients, 320.2 GFLOPs

# YOLO11n backbone
backbone:
  # [from, repeats, module, args]
  - [-1, 1, Conv, [64, 3, 2]] # 0-P1/2
  - [-1, 1, Conv, [128, 3, 2]] # 1-P2/4
  - [-1, 2, C3k2_CBAM, [256, False, 0.25]] # 2 - P2å±‚è¾“å‡ºï¼ˆ256é€šé“ï¼‰
  - [-1, 1, Conv, [256, 3, 2]] # 3-P3/8
  - [-1, 2, C3k2_CBAM, [512, False, 0.25]] # 4 - P3å±‚è¾“å‡ºï¼ˆ512é€šé“ï¼‰
  - [-1, 1, Conv, [512, 3, 2]] # 5-P4/16
  - [-1, 2, C3k2_CBAM, [512, True]] # 6 - P4å±‚è¾“å‡ºï¼ˆ512é€šé“ï¼‰
  - [-1, 1, Conv, [1024, 3, 2]] # 7-P5/32
  - [-1, 2, C3k2_CBAM, [1024, True]] # 8 - P5å±‚è¾“å‡ºï¼ˆ1024é€šé“ï¼‰
  - [-1, 1, SPPF, [1024, 5]] # 9
  - [-1, 2, C2PSA, [1024]] # 10

# YOLO11n head with P2 feature layer
head:
  # ========== P4è·¯å¾„ ==========
  - [-1, 1, nn.Upsample, [None, 2, "nearest"]] # 11 - ä»P5ä¸Šé‡‡æ ·åˆ°P4å°ºå¯¸
  - [[-1, 6], 1, Concat, [1]] # 12 - cat backbone P4 (è¿æ¥11å’Œbackboneçš„6)
  - [-1, 2, C3k2_CBAM, [512, False]] # 13 - P4å¤„ç†å±‚

  # ========== P3è·¯å¾„ ==========
  - [-1, 1, nn.Upsample, [None, 2, "nearest"]] # 14 - ä»P4ä¸Šé‡‡æ ·åˆ°P3å°ºå¯¸
  - [[-1, 4], 1, Concat, [1]] # 15 - cat backbone P3 (è¿æ¥14å’Œbackboneçš„4)
  - [-1, 2, C3k2_CBAM, [256, False]] # 16 - P3/8-smallæ£€æµ‹å±‚

  #- [-1, 1, Conv, [256, 3, 2]]  #è¿™ä¸€è¡Œæ¢åé¢å¤š#ä¸­é—´
  ##################
  # ========== æ–°å¢ï¼šP2è·¯å¾„ ==========
  - [-1, 1, nn.Upsample, [None, 2, "nearest"]] # 17 - ä»P3ä¸Šé‡‡æ ·åˆ°P2å°ºå¯¸
  #- [2, 1, Conv, [128, 1, 1]] # 18 - å¯¹backboneçš„P2å±‚è¿›è¡Œé€šé“è°ƒæ•´ï¼ˆ256â†’128ï¼‰
  - [[-1, 2], 1, Concat, [1]] # 19 - cat backbone P2 (è¿æ¥18å’Œ17)
  - [-1, 2, C3k2_CBAM, [128, False]] # 20 - P2/4-xsmallæ£€æµ‹å±‚

  # ========== ä¸‹é‡‡æ ·è·¯å¾„ï¼šP2 â†’ P3 ==========
  - [-1, 1, Conv, [128, 3, 2]] # 21 - ä»P2ä¸‹é‡‡æ ·åˆ°P3å°ºå¯¸ï¼ˆ128â†’256é€šé“ï¼‰
  - [[-1, 16], 1, Concat, [1]] # 22 - cat head P3 (è¿æ¥21å’Œ16)
  - [-1, 2, C3k2_CBAM, [256, False]] # 23 - P3/8-smallæ£€æµ‹å±‚ï¼ˆå¢å¼ºç‰ˆï¼‰

  # ========== ä¸‹é‡‡æ ·è·¯å¾„ï¼šP3 â†’ P4 ==========
  - [-1, 1, Conv, [256, 3, 2]] # 24 - ä»P3ä¸‹é‡‡æ ·åˆ°P4å°ºå¯¸
  - [[-1, 13], 1, Concat, [1]] # 25 - cat head P4 (è¿æ¥24å’Œ13)
  - [-1, 2, C3k2_CBAM, [512, False]] # 26 - P4/16-mediumæ£€æµ‹å±‚

  # ========== ä¸‹é‡‡æ ·è·¯å¾„ï¼šP4 â†’ P5 ==========
  - [-1, 1, Conv, [512, 3, 2]] # 27 - ä»P4ä¸‹é‡‡æ ·åˆ°P5å°ºå¯¸
  - [[-1, 10], 1, Concat, [1]] # 28 - cat head P5 (è¿æ¥27å’Œ10)
  - [-1, 2, C3k2_CBAM, [1024, True]] # 29 - P5/32-largeæ£€æµ‹å±‚

  # ========== JDEå¤´ï¼šåŒ…å«P2, P3, P4, P5å››ä¸ªæ£€æµ‹å±‚ ==========
  #- [[20, 23, 26, 29], 1, JDE, [nc, 256, 6]] # JDE(P2, P3, P4, P5)
  ##########  è¿™é‡Œä¹Ÿè¿›è¡Œäº†ä¿®æ”¹
  - [[19, 22, 25, 28], 1, JDEIM_Box, [nc, 256, 6]] # JDE(P2, P3, P4, P5)
  # ç´¢å¼•è¯´æ˜ï¼š
  # 20 = P2/4-xsmallæ£€æµ‹å±‚ï¼ˆ128é€šé“ï¼‰
  # 23 = P3/8-smallæ£€æµ‹å±‚ï¼ˆ256é€šé“ï¼Œç»è¿‡P2â†’P3ä¸‹é‡‡æ ·è·¯å¾„å¢å¼ºï¼‰
  # 26 = P4/16-mediumæ£€æµ‹å±‚ï¼ˆ512é€šé“ï¼‰
  # 29 = P5/32-largeæ£€æµ‹å±‚ï¼ˆ1024é€šé“ï¼‰

  
# çŠ¶æ€é¢„æµ‹é…ç½®
state_prediction:
  enabled: true
  #classes: ["standing", "sitting", "lying", "running", "walking"]
  loss_weight: 1.0

#åé¢ä¸ºperson_searchä¸“é—¨æ·»åŠ çš„å‚æ•° Additional ReID configuration for person search
reid:
  enabled: true
  embedding_dim: 256
  feature_layer: 8  # Use features from backbone layer 8 (A2C2f layer)
  loss_weight: 0.5  # Weight for ReID loss
  triplet_margin: 0.3  # Margin for triplet loss